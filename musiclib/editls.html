<!-- $Id: editls.html,v 1.3 2022/02/28 04:15:45 dfm Exp dfm $
     Log:$

     display/edit a song from local storage xml
-->
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Edit ls song</title>
<link rel="stylesheet" href="/dfm_ws/jquery-ui-themes-1.13.0/themes/smoothness/jquery-ui.css">
<style>
.gdid { font-family: Courier; }
.chgd { background: powderblue; }
.reqd { background-color: pink; }
.added { background-color: lightblue; }
td,th { padding: 6px; }
td,th { border-style: solid; border-color: black; border-width: 2px; }
textarea { overflow-wrap: break-word; border: none; background-color: transparent; resize: none; outline: none; }
textarea { font-family: Arial; font-size: 18px; height: 1.6em; }
textarea:focus { border-style: solid; }
th { background-color: lightgreen; border-bottom: solid 2px; font-family: Arial; font-size: 18px; }
table { border-style: solid; border-collapse: collapse; border-width: 2px; border-color: black; }
table.songrow { width: 100% }
table.wrapper { width: 90% }
@media print {
  @page { size: letter portrait; margin: .25in; }
  html, body { width: 8.0in; height: 90%; }
}
caption { background-color: lightgreen; font-family: Arial; font-weight: bold; font-size: larger; }
#songtab { width: 100%; }
#aliastab { width: 100%; }
#sheettab { width: 100%; }
#trackstab { width: 100%; }
#keys option { font-family: Arial; font-size: 18; font-weight: bold !important; }
#catPopUp {
   z-index: 100;
   position: absolute;
   display: none;
   background-color: rgba(255,255,255,1.0);
}
#songtab td { text-align: left; font-family: Arial; font-size: 18; }
#keyPopUp, #pitPopUp { text-align: left; font-family: Arial; font-size: 18; font-weight: bold !important; }
#catPopUp td { border-style: solid; border-color: blue;
    text-align: left; font-family: Arial; font-size: 18; font-weight: bold !important; }
#catSelect table { border-style: solid; border-width: 2px; border-collapse: collapse; }
#catSelect {
   z-index: 1000;
   width: 40em;
   position: relative;
   top: 2px;
   left: 2px;
}
#keyPopUp, #pitPopUp {
   text-align: center; font-size: 18; font-weight: bold !important;
   z-index: 100;
   position: absolute;
   display: none;
}
#keySelect, #pitSelect {
   z-index: 1000;
   width: 4em;
   position: relative;
   top: 2px;
   left: 2px;
}
</style>
<script src="getqv.js"></script>
<script src="fmtDate.js"></script>
<script src="/dfm_ws/jquery-3.6.0.js"></script>
<script src="/dfm_ws/jquery-ui-1.13.0/jquery-ui.js"></script>
<script type="text/javascript">
// define globals here...
var song = [];
var allCats = [];

var deleteCount = 0;
var varnam; // var. name (from rowhdrs) when cell is selected
var selval; // value when cell is selected

function songtoxml() {
    let attrs = ['id', 'name'];
    let props = [ 'notes', 'location', 'key', 'pitch', 'words', 'arranger', 'composer',
        'lyricist', 'learn_by', 'ordered', 'stockID', 'copies', 'source', 'copyright', 'crdate'];

    if (!song || song.isAlias) {
        return;
    }
    let sid = song['id'];
    let nam = song['name'];
    newxml = `<song id="${sid}" name="${nam}">\n`;
    if (song.hasOwnProperty('aliases')) {
        for (let aka of song['aliases']) {
            newxml += `  <alias>${aka}</alias>\n`;
        }
    }
    for (let cat of song['categories']) {
        newxml += `  <category>${cat}</category>\n`;
    }
    for (let prop of props) {
        if (song.hasOwnProperty(prop)) {
            let val = song[prop];
            newxml += `  <${prop}>${val}</${prop}>\n`;
        }
    }
    if (song.hasOwnProperty('sheet')) {
        newxml += `  <sheet gdid="${song.sheet.gdid}" sheet="${song.sheet.path}" />\n`;
    }
    if (song.hasOwnProperty('tracks')) {
        newxml += `  <tracks>\n`;
        for (let voice in song.tracks) {
            for (let trk of song.tracks[voice]) {
                newxml += `    <voice gdid="${trk.gdid}" mods="${trk.mods}" path="${trk.path}" voice="${voice}" />\n`;
            }
        }
        newxml += "  </tracks>\n";
    }
    newxml += "</song>\n";

    // expand special chars here - only & seems to be needed.
    let re = /&/g;
    newxml = newxml.replace(re, "&amp;");

    return newxml;
}
function saveSong() {
    let songxml = songtoxml();
    let lsname = `song${song.id}`;
    localStorage.setItem(lsname, songxml);
}
function loadSong() {
    var wantsid = getQueryVariable("sid", '');
    var newsid = getQueryVariable("new", '');

    if (wantsid == "" && newsid != "") {
        song = [];
        song.id = newsid;
        // song.name = "**";
        song.isNew = true;
        song.categories = [];
    } else if (wantsid != "") {
        let lsname = `song${wantsid}`;
        songxml = localStorage.getItem(lsname);
        // console.log(songxml);

        parser = new DOMParser();
        songNodes = parser.parseFromString(songxml,"text/xml").getElementsByTagName("song");
        console.log(`${songNodes.length} song nodes for wantsid ${wantsid}`);


        for (let songNode of songNodes) {
            song = [];
            for (let att of songNode.attributes) {
                song[att.name] = att.value;
            }

            let nam = song['name'];
            let sid = song['id'];
            console.log(`wantsid ${wantsid}, sid ${sid}, name ${song.name}`);

            let akas = [];
            let cat = '';
            let categories = [];

            for (let prop of songNode.children) {
                if (prop.nodeName == "alias") {
                    akas.push(prop.textContent);
                } else if (prop.nodeName == "category") {
                    cat = prop.textContent;
                    categories.push(cat);
                    if (allCats.indexOf(cat) < 0) {
                        allCats.push(cat);
                    }
                } else if (prop.nodeName == "tracks") {
                    let tracks = [];
                    for (let subp of prop.children) {
                        if (subp.nodeName == "voice") {
                            let voice = [];
                            let vname = 'phony';
                            for (let att of subp.attributes) {
                                if (att.name == 'voice') {
                                    vname = att.value;
                                } else {
                                    voice[att.name] = att.value;
                                }
                            }
                            if (!tracks.hasOwnProperty(vname)) {
                                tracks[vname] = [];
                            }
                            tracks[vname].push(Object.assign(voice));
                        } else {
                            console.log(`track for ${song} has child ${subp.nodeName}??`);
                        }
                    }
                    song[prop.nodeName] = Object.assign(tracks);
                } else if (prop.nodeName == "sheet") {
                    let sheet = [];
                    for (let att of prop.attributes) {
                        sheet[att.name] = att.value;
                    }
                    song[prop.nodeName] = Object.assign(sheet);
                } else {
                    song[prop.nodeName] = prop.textContent;
                }
            }
            if (categories.length > 0) {
                song['categories'] = Object.assign(categories);
            } else {
                song['categories'] = ["None"];
            }
            if (akas.length > 0) {
                song['aliases'] = akas.slice();
            }
        }

        displaySong();
        displayAliases();
        displaySheet();
        displayTracks();

        setTabindex();
    }
}
function addAlias() {
    // event target is the img of the add button.
    let tgt = event.target;

    let altab = tgt.closest("table");
    let alrow = altab.insertRow(-1);
    let aliasel = alrow.insertCell(0);

    let ta = document.createElement("TEXTAREA");
    ta.cols = "90";
    ta.tabIndex = "0";
    ta.addEventListener("focusout", left_field);
    ta.addEventListener("focusin", enter_field);
    ta.classList.add("added");

    // let tx = document.createTextNode("**");
    let tx = document.createTextNode("");
    ta.appendChild(tx);
    aliasel.appendChild(ta);
    if (! song.hasOwnProperty("aliases")) {
        song.aliases = [];
    }
    //song.aliases.push("**");

    let delbuttel = document.createElement("th");
    delbuttel.width = "4%";
    delbuttel.onclick = delAlias;
    alrow.appendChild(delbuttel);
    let alimg = document.createElement('img');
    alimg.src = 'minus2.png';
    alimg.title = 'Delete one';
    delbuttel.appendChild(alimg);
}
function delAlias() {
    console.log("Deleting an alias!");
    // event target is the img of the delete button.
    let tgt = event.target;
    let alrow = tgt.closest("tr");

    let alias = alrow.children[0].children[0].value;
    let anum = song.aliases.indexOf(alias);
    if (anum < 0) {
        alert("program error - alias not in song??");
    } else {
        let rownum = alrow.rowIndex;
        let altab = alrow.closest("table");
        altab.deleteRow(rownum);
        console.log(`deleted row ${rownum}, alias ${alias}`);
        song.aliases.splice(rownum, 1);
        deleteCount++;
    }
}
function displayAliases() {
    let altab = "<table><caption>Aliases</caption>\n";
    altab += "<tr class='rowhdrs'><th>Alias</th>";
    altab += "<th width='4%' onclick='addAlias()'><img src='plus2.png' title='Add one'></img></th></tr>\n";
    if (song.hasOwnProperty('aliases')) {
        song['aliases'].forEach(function(alias) {
            altab += `<tr><td><textarea cols='90'>${alias}</textarea></td>`;
            altab += "<th width='4%' onclick='delAlias()'><img src='minus2.png' title='Delete one'></img></th></tr>\n";
        });
    } else {
        console.log("no aliases...");
    }
    altab += "</table>";
    document.querySelector("#aliastab").innerHTML = altab;
}
function addSheet() {
    console.log("Adding a sheet!");
    // event target is the img of the add button.
    let tgt = event.target;

    let shtab = tgt.closest("table");
    if (shtab.rows.length > 1) {
        // count seems to give the number after we do this add??
        alert("Sorry, no more than one sheet per song.");
        return;
    }
    // add a row at the end of the table
    let shrow = shtab.insertRow(-1);

    for (let col of ['file', 'gdid']) {
        let newel = shrow.insertCell(-1);
        let ta = document.createElement("TEXTAREA");
        ta.cols = "40";
        ta.tabIndex = "0";
        ta.addEventListener("focusout", left_field);
        ta.addEventListener("focusin", enter_field);
        ta.classList.add("added");

        // let tx = document.createTextNode("**");
        let tx = document.createTextNode("");
        ta.appendChild(tx);
        newel.appendChild(ta);

        if (! song.hasOwnProperty("sheet")) {
            song.sheet = [];
        }
        // song.sheet[col] = "**";
    }

    let delbuttel = document.createElement("th");
    delbuttel.width = "4%";
    delbuttel.onclick = delSheet;
    shrow.appendChild(delbuttel);
    let shimg = document.createElement('img');
    shimg.src = 'minus2.png';
    shimg.title = 'Delete one';
    delbuttel.appendChild(shimg);
}
function delSheet() {
    console.log("Deleting a sheet!");
    let tgt = event.target;
    let shrow = tgt.closest("tr");
    let file = shrow.children[0].textContent;
    let gdid = shrow.children[1].textContent;
    let rownum = shrow.rowIndex;
    let shtab = shrow.closest("table");
    shtab.deleteRow(rownum);
    console.log(`selected sheet ${file}, gdid ${gdid}`);
    delete song.sheet; // FIX: UI implies a list...
    deleteCount++;
}
function displaySheet() {
    let shtab = "<table><caption>Sheet Music</caption>\n";
    let shhdrs = ['File', 'Google Drive ID'];
    shtab += "<tr class='rowhdrs'><th>" + shhdrs.join("</th><th>") + "</th>";
    shtab += "<th width='4%' onclick='addSheet()'><img src='plus2.png' title='Add one'></img></th></tr>\n";
    if (song.hasOwnProperty('sheet')) {
        let fil = song['sheet']['sheet'];
        let gdid = song['sheet']['gdid'];
        shtab += `<tr><td><textarea cols='40'>${fil}</textarea></td>`;
        shtab += `<td><textarea class='gdid' cols='40'>${gdid}</textarea></td>`;
        shtab += "<th width='4%' onclick='delSheet()'><img src='minus2.png' title='Delete one'></img></th></tr>\n";
    } else {
        console.log("no sheets...");
    }
    shtab += "</table>\n";
    document.querySelector("#sheettab").innerHTML = shtab;
}
function delSong() {
    console.log("Deleting a SONG!");
    if (confirm(`Delete song ${song.name} (${song.id})?
    (will do Save)`)) {
        console.log("you said yes!");
        excludeIds.push(song.id);
        saveit();
        let tabel = document.querySelector(".wrapper");
        tabel.outerHTML = `<h3>${song.name} deleted.</h3>`;
    } else {
        console.log("you said no...");
    }
}
function displaySong() {
    let rowHeaders = [
        ['id', 'key', 'pitch', 'category', 'name', 'notes', 'location'],
        ['arranger', 'composer', 'lyricist', 'learn_by', 'words'],
        ['ordered', 'stockID', 'copies', 'source', 'copyright', 'crdate'],
    ];

    let reqd = ['name', 'key', 'category', 'words'];

    let colWidth = {id:4, name:32, notes:20, location:16, key:4, pitch:4, category:16, words:32,
        arranger:16, composer:40, lyricist:40, learn_by:10, ordered:10, stockID:10, copies:4, source:8,
        copyright:40, crdate:10};

    let songhtml = "";

    let isnew = song.isNew;
    for (let row of rowHeaders) {
        songhtml += "<tr><td>";
        songhtml += `<table class='songrow'>`;
        songhtml += "<tr class='rowhdrs'><th>" + row.join("</th><th>") + "</th></tr>\n";
        songhtml += "<tr>";
        for (let colnam of row) {
            let val = "";
            if (colnam == "category") {
                val = song['categories'].join(", ");
            } else if (song.hasOwnProperty(colnam)) {
                val = song[colnam];
            } else {
                val = "";
            }
            if (isnew && reqd.includes(colnam)) {
                songhtml += `<td><textarea class='reqd' cols='${colWidth[colnam]}' placeholder='${colnam}'>${val}</textarea></td>`;
            } else if (colnam == "category") {
                songhtml += `<td id="catSelTD">${val}</td>`;
            } else if (colnam == "key") {
                songhtml += `<td id="keySelTD">${val}</td>`;
            } else if (colnam == "pitch") {
                songhtml += `<td id="pitSelTD">${val}</td>`;
            } else {
                songhtml += `<td><textarea cols='${colWidth[colnam]}'>${val}</textarea></td>`;
            }
        }
        songhtml += "</tr>\n";
        songhtml += "</td></tr></table>\n";
        songhtml += "</td></tr>";
    }

    let st = document.querySelector("#songtab");
    st.innerHTML = songhtml;
    let caption = st.createCaption();
    caption.textContent = song.name;
    caption.style.fontSize = "2em";
}
function addTrack() {
    console.log("Adding a track!");
    let tgt = event.target;
    let trtab = tgt.closest("table");
    // add a row at the end of the table
    let trrow = trtab.insertRow(-1);
    let trwid = {voice:5, mods:12, path:60, gdid:50}

    for (let col of ['voice', 'mods', 'path', 'gdid']) {
        let newel = trrow.insertCell(-1);
        let ta = document.createElement("TEXTAREA");
        ta.cols = trwid[col];
        ta.tabIndex = "0";
        ta.addEventListener("focusout", left_field);
        ta.addEventListener("focusin", enter_field);
        ta.classList.add("added");

        let tx = document.createTextNode("**");
        ta.appendChild(tx);
        newel.appendChild(ta);
        if (! song.tracks.hasOwnProperty(col)) {
            song.tracks[col] = [];
        }
        if (col != 'voice') {
            song.tracks.voice[col] = "**";
        }
    }

    let delbuttel = document.createElement("th");
    delbuttel.width = "4%";
    delbuttel.onclick = delSheet;
    trrow.appendChild(delbuttel);
    let trimg = document.createElement('img');
    trimg.src = 'minus2.png';
    trimg.title = 'Delete one';
    delbuttel.appendChild(trimg);
}
function delTrack() {
    console.log("Deleting a track!");
    // event target is the img of the delete button.
    let tgt = event.target;
    let trrow = tgt.closest("tr");
    let rownum = trrow.rowIndex;
    let trtab = trrow.closest("table");
    trtab.deleteRow(rownum);
    console.log(`deleted track ${rownum}`);
    deleteCount++;
}
function displayTracks() {
    let trhdrs = ['Voice', 'Mods', 'Path', 'Google Drive ID'];
    let trwid = {voice:5, mods:12, path:60, gdid:50}

    let trtab = "<table><caption>Training Tracks</caption>\n";
    trtab += "<tr class='rowhdrs'><th>" + trhdrs.join("</th><th>") + "</th>";
    trtab += "<th width='4%' onclick='addTrack()'><img src='plus2.png' title='Add one'></img></th></tr>\n";
    if (song.hasOwnProperty('tracks')) {

        for (let voice in song.tracks) {
            for (let track of song.tracks[voice]) {
                trtab += `<tr class='trackrow'><td><textarea cols='${trwid['voice']}'>${voice}</textarea></td>`;
                trtab += `<td><textarea cols='${trwid['mods']}'>${track['mods']}</textarea></td>`;
                trtab += `<td><textarea cols='${trwid['path']}'>${track['path']}</textarea></td>`;
                trtab += `<td><textarea class='gdid' cols='${trwid['gdid']}'>${track['gdid']}</textarea></td>`;
                trtab += "<th width='4%' onclick='delTrack()'><img src='minus2.png' title='Delete one'></img></th></tr>\n";
                trtab += "</tr>\n";
            }
        }
    } else {
        console.log("no tracks...");
    }
    trtab += "</table>\n";
    document.querySelector("#trackstab").innerHTML = trtab;
}
function setTabindex() {
    let alltas = document.querySelectorAll("TEXTAREA");
    let ti = 1;
    for (let ta of alltas) {
        ti = 0;
        let td = ta.parentNode;
        let tr = td.parentNode;
        let rowindex = tr.rowIndex;

        ta.tabIndex = ti;
        ta.addEventListener("focusout", left_field);
        ta.addEventListener("focusin", enter_field);
    }
}
function enter_field() {
    // onfocus event - 
    let ta = event.target;
    // console.log(`entering enter_field, ta.tag ${ta.tagName} ti ${ta.tabIndex}`);

    if (ta.tagName != "TEXTAREA") {
        console.log(`bad selection! tag is ${ta.tagName}`);
        window.getSelection().empty();
        return;
    }

    // select all the text in the textarea
    ta.select();
    selval = ta.value;

    // get the var. name for the selected textarea from the header row,
    // which is the first child of the tbody ancestor.
    let hdrrow = ta.closest("tbody").children[0];
    let col = ta.parentNode.cellIndex;
    varnam = hdrrow.children[col].innerText;
    console.log(`${varnam}: ${selval}`);
}
function left_field() {
    // caught leaving a textarea. process new value.
    let ta = event.target;
    // console.log(`entering left_field, ta.tag ${ta.tagName} ti ${ta.tabIndex}`);

    // reg. expression for all keys and pitches
    let keypat = /[A-G][b#m]?[m]?/;

    if (ta.tagName != "TEXTAREA") {
        console.log(`bad selection in left_field! tag is ${ta.tagName}`);
        window.getSelection().empty();
        return;
    }

    let newval = ta.value;
    if (! newval || newval == selval) {
        // nothing changed - go away.
        return;
    }

    // get the section (song, alias, sheet, or track) from the id of the ancestor
    // table with an id.
    let sect = ta.closest("table[id]").id;
    // console.log(`in left_field for section ${sect}, var ${varnam}`);

    let td = ta.parentNode;
    let tr = td.parentNode;

    // get the cells (td) from the selected row
    let tas = Array.from(tr.getElementsByTagName("TEXTAREA"));

    // a value was entered, and it wasn't same as before...
    if (sect  == 'songtab') {
        // validate some songtab entries...
        switch (varnam) {
            case 'category':
                newcats = newval.split(",");
                for (tcat of newcats) {
                    tcat = tcat.trim();
                    if (! allCats.includes(tcat)) {
                        alert("Sorry, " + tcat + " is not a valid category!");
                        return;
                   }
                }
                // song['categories'] gets the list. the TD gets the joined string
                newvallist = newcats;
                newval = newcats.join(", ");
                break;

            case 'key':
            case 'pitch':
                // make the first char uppercase
                newval = newval.charAt(0).toUpperCase() + newval.slice(1);
                if (! newval.match(keypat)) {
                    alert("Sorry, " + newval + " is not a valid " + varnam + "!");
                    return;
                }
                break;

            case 'id':
                if (allsids.indexOf(newval) >= 0) {
                    alert("Sorry, song id " + newval + " is already in use.");
                    return;
                }
                break;
        }
    }

    ta.value = newval;

    // if user just satisfied a required value, mark it changed
    if (ta.classList.contains("reqd")) {
        ta.classList.replace("reqd", "chgd");
    } else {
        ta.classList.add("chgd");
    }
    // console.log(`you entered ${newval}!`);

    // all remaining varnam refs are song object props, so category s/b categories.
    if (varnam == "category") {
        varnam = "categories";
        newval = newvallist;
    }

    // update the song object
    switch (sect) {
        case 'aliastab':
            if (song.hasOwnProperty('aliases')) {
                let n = song.aliases.indexOf(selval);
                song.aliases[n] = newval;
            } else {
                song.aliases = [newval];
            }
            console.log(`replaced ${varnam} ${selval} with ${newval} for ${song.name}`);
            break;
        case 'sheettab':
            // we only allow one sheet for a song - could be multiple songs with the
            // same name and different sheets, but each would have a unique song id.
            if (varnam == "File") {
                song.sheet.sheet = newval;
                console.log(`replaced File ${selval} with ${newval} for ${song.name}`);
            } else if (varnam == "Google Drive ID") {
                song.sheet.gdid = newval;
                console.log(`replaced GD ID ${selval} with ${newval} for ${song.name}`);
            } else {
                alert(`sheet tab varnam ${varnam} unknown!`);
            }
            break;
        case 'trackstab':
        case 'songtab':
            // here, we need to check if the variable was in song previously, add it if not.
            if (song.hasOwnProperty(varnam)) {
                let valfromobj = song[varnam];
                if (valfromobj == selval) {
                    song[varnam] = newval;
                    console.log(`replaced ${varnam} with ${newval} for sid ${song.id}`);
                } else {
                    alert("ERROR: " + valfromobj + " != " + selval);
                    return;
                }
            } else {
                song[varnam] = newval;
                console.log(`set new ${varnam} to ${newval} for sid ${song.id}`);
            }
            break;
    }
}
function reload() {
    window.location.reload();
}
function init() {
    loadSong();

// from https://stackoverflow.com/questions/9358643/how-to-pop-up-a-select-list-and-update-the-site-with-the-selection/9358802
 $("#catSelTD").click(function(e) {
     let el = e.target;
    const rect = el.getBoundingClientRect();
    let left = (rect.left + window.scrollX) + "px";
    let top = (rect.top + window.scrollY + el.offsetHeight) + "px";
     $("#catPopUp").css({ left: left, top: top });
     $("#catPopUp").show();
     let curcats = $("#catSelTD").text().split(",");
      $("#catSelect").find("input[type='checkbox']").each(function (key, val) {
          let v = val.nextSibling.nodeValue;
          if (curcats.includes(v)) {
              val.checked = true;
          }
      });
 });
 $("#keySelTD").click(function(e) {
     let el = e.target;
    const rect = el.getBoundingClientRect();
    let left = (rect.left + window.scrollX) + "px";
    let top = (rect.top + window.scrollY + el.offsetHeight) + "px";
     $("#keyPopUp").css({ left: left, top: top });
     // set value empty, old value in placeholder as reminder.
     let selel = document.getElementById("keySelect");
     let v = $("#keySelTD").html();
     selel.value="";
     selel.placeholder=v;
     $("#keyPopUp").show();
 });
 $("#pitSelTD").click(function(e) {
     let el = e.target;
    const rect = el.getBoundingClientRect();
    let left = (rect.left + window.scrollX) + "px";
    let top = (rect.top + window.scrollY + el.offsetHeight) + "px";
     $("#pitPopUp").css({ left: left, top: top });
     let selel = document.getElementById("pitSelect");
     let v = $("#pitSelTD").html();
     selel.value="";
     selel.placeholder=v;
     $("#pitPopUp").show();
 });
 $("#catExit").click(function(e) {
     let cats = [];
      $("#catSelect").find("input[type='checkbox']").each(function (key, val) {
          if (val.checked) {
              cats.push(val.nextSibling.nodeValue);
          }
      });
     let catstr = cats.join(",");
    $("#catSelTD").text(catstr);
    $("#catPopUp").hide();
 });
 $("#keySelect").change(function(e) {
    $("#keySelTD").html($("#keySelect").val());
    $("#keyPopUp").hide();
 });
 $("#pitSelect").change(function(e) {
    $("#pitSelTD").html($("#pitSelect").val());
    $("#pitPopUp").hide();
 });
}
</script>
</head>
<body onload="init()">
    <button onclick="delSong()">Delete Song</button>
    <button onclick="saveit()">Save</button>
    <button onclick="reload()">Reset</button>
<table class='wrapper'>
     <tr><td><table id='songtab'></table></td></tr>
     <tr><td><table id='aliastab'></table></td></tr>
     <tr><td><table id='sheettab'></table></td></tr>
     <tr><td><table id='trackstab'></table></td></tr>
 </table>
<div id="catPopUp">
  <div id="catSelect">
  <table><tr>
  <td><input id="cb2" type="checkbox">Current</input></td>
  <td><input id="cb7" type="checkbox">Show</input></td>
  <td><input id="cb5" type="checkbox">PoleCat</input></td>
  <td><input id="cb6" type="checkbox">PoleCatII</input></td>
  <td><input id="cb1" type="checkbox">Christmas</input></td>
</tr><tr>
  <td><input id="cb3" type="checkbox">Old</input></td>
  <td><input id="cb4" type="checkbox">Other</input></td>
  <td><input id="cb8" type="checkbox">TTS</input></td>
  <td><input id="cb9" type="checkbox">YF2</input></td>
  <td><button id="catExit">Close</button></td>
</tr>
  </table>
  </div>
</div>
<div id="keyPopUp">
    <input list="keys" name="songkey" id="keySelect" value=""></input>
</div>
<div id="pitPopUp">
    <input list="keys" name="songpit" id="pitSelect" value=""></input>
</div>
<datalist id="keys" autocomplete="off">
    <option>A</option>
    <option>Am</option>
    <option>A&#x266d;</option>
    <option>A&#x266d;m</option>
    <option>A&#x266f;</option>
    <option>A&#x266f;m</option>
    <option>B</option>
    <option>Bm</option>
    <option>B&#x266d;</option>
    <option>B&#x266d;m</option>
    <option>C</option>
    <option>Cm</option>
    <option>C&#x266f;</option>
    <option>C&#x266f;m</option>
    <option>D</option>
    <option>Dm</option>
    <option>D&#x266d;</option>
    <option>D&#x266d;m</option>
    <option>D&#x266f;</option>
    <option>D&#x266f;m</option>
    <option>E</option>
    <option>Em</option>
    <option>E&#x266d;</option>
    <option>E&#x266d;m</option>
    <option>F</option>
    <option>Fm</option>
    <option>F&#x266f;</option>
    <option>F&#x266f;m</option>
    <option>G</option>
    <option>Gm</option>
    <option>G&#x266d;</option>
    <option>G&#x266d;m</option>
    <option>G&#x266f;</option>
    <option>G&#x266f;m</option>
</datalist>
</body>
</html>
