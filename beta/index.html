<!DOCTYPE html>
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<!--

    $Id: index.html,v 1.3 2022/08/02 02:34:06 dfm Exp $
    $Log: index.html,v $
    Revision 1.3  2022/08/02 02:34:06  dfm
    minor edits

    Revision 1.2  2022/07/05 23:05:35  dfm
    change eventlist url so it will work on github
    use ch.html to display cheat sheet
    remove unused getMusicLib ref

    Revision 1.1  2022/06/30 23:40:53  dfm
    Initial revision


    build newest-first select list of cheat sheets,
    calls ch.html to display cheat sheet when event is selected.
-->
<title id="doctitle">Select cheat sheets</title>
<link rel="stylesheet" href="select.css" />
<script src="getEventList.js"></script>
<script>

var eventlist = {}; // indexed by dtndx of event, value is event definition
var newestFirst = []; // most recent matches list, newest (biggest) first
var evndx, newevent; // event info for ch.html

function loads() {
    let elurl = "events.xml";
    let gelpromise = getEventList(elurl);

    let promises = [gelpromise];

    Promise.all(promises).then(values => {
        // all promises complete. values is list of values returned 
        // by the promises, in the same order.
        eventlist = values[0];

        // events and musiclib xmls both loaded. get list of date indexes, sorted newest (biggest) first
        let newestFirst = Object.keys(eventlist).sort((a, b) => a < b ? 1 : a > b ? -1 : 0);
        let nevshow = 999; // number of events to add to select
        let nadd = 0;
        let html = `<select id='sel' class='select-css'>
<option data-dtndx=''>select an event</option>;
`;
        for (let ndx of newestFirst) {
            let ev = eventlist[ndx];
            html += `<option data-dtndx='dt${ndx}'>${ev['where']} - ${ev['when']}</option>`;
            nadd += 1;
            if (nadd >= nevshow) {
                break;
            }
        }
        html += "</select>";
        document.querySelector("#selev").innerHTML = html;

        // listen for changes on the select
        document.querySelector("#sel").addEventListener('change', perfev => eventsel(perfev.target));

        // setup complete - user selection will cause cheat sheet to display.
     });
}

function eventsel(tab) {
    // user selected an event. 

    // get the dtndx from the data-dtndx attribute of the selected event.
    let dtndx = tab.options[tab.selectedIndex].dataset.dtndx;
    if (dtndx == "") {
        // the first option has dtndx == ''.
        return;
    }
    // remove the "dt" 
    evndx = dtndx.substring(2);
    newevent = eventlist[evndx];
    let chwin = window.open("ch.html");
}
</script>
</head>
<body onload='loads()'>
    <div id='selev'></div>
</body>
</html>
