<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title id="doctitle">cheat</title>
<style>
.key { text-align: center; }
td,th { padding: 6px; }
th {
    background-color: lightgreen;
    border-bottom: solid 2px;
    font-size: 18px;
}
.tabletitle {
    background-color: lightgreen;
    text-align: center;
    font-size: 24px;
    border-bottom: solid 5px;
}
.hidden { display: none; }
tr:nth-child(even) { background: #CCC }
tr:nth-child(odd) { background: #FFF }
.partsel { text-align: center; background: #DDD }
table {
    border-collapse: collapse;
    font-family: Arial;
    font-size: 18px;
    font-weight: bold;
    border-width: 5px;
}
</style>
<script src="getqv.js"></script> 
<script src="loadlib.js"></script>
<script language="JavaScript">
var songlib = [];
function clickmix() {
    let defaultVoice = localStorage.getItem("defaultVoice");
    if (! defaultVoice) {
        defaultVoice = "mix";
    }
    let buttonId = "sel" + defaultVoice;
    let butt = document.getElementById(buttonId);
    butt.click();
}
function vsel(e) {
    setvoice(e.value);
}
function setvoice(sel) {
    // show the class we were called with (i.e., remove "hidden")
    for (let element of document.getElementsByClassName(sel)) {
       element.classList.remove("hidden");
    }
    let others = new Set(['bass', 'bari', 'lead', 'tenor', 'mix']);
    others.delete(sel);
    // don't show the rest of the classes
    for (let v of others) {
        for (let element of document.getElementsByClassName(v)) {
           element.classList.add("hidden");
        }
    }
    localStorage.setItem("defaultVoice", sel);
}

function makeCheat(jsontxt) {
    let sl = JSON.parse(jsontxt);
    var venue = sl['venue'];
    var evdate = fmtDate(sl['date']);
    var evtitl = venue + " - " + evdate;
    document.getElementById("doctitle").textContent = evtitl;
    document.getElementById("tabtitl").textContent = evtitl;

    var slsongs = sl['songs'];

    let voices = ['bass', 'bari', 'lead', 'tenor', 'mix'];
    let h = "";
    for (let song of slsongs) {
        let tit = songlib[song]['title'];
        let wds = songlib[song]['firstwords'];
        let key = songlib[song]['key'];
        for (let voice of voices) {
            let classes = voice;
            if (voice != "mix") {
                classes += " hidden";
            }
            if (voice in songlib[song]) {
                h += `<tr class='${classes}'><td class='key'>${key}</td><td>`
                for (let mods in songlib[song][voice]) {
                    let fid = songlib[song][voice][mods][0];
                    h += `<a href='https://drive.google.com/open?id=${fid}'>${tit} ${mods}</a><br/>`
                }
                h += `</td><td>${wds}</td></tr>`
            } else {
                // no track for voice for this song
                h += `<tr class='${classes}'><td class='key'>${key}</td><td>${tit}</td><td>${wds}</td></tr>`
            }
        }
    }
    document.getElementById("songtable").outerHTML = h;
}
/*
function loadDoc(doc, rdyfunc) {
  let xhr = new XMLHttpRequest();
  xhr.onreadystatechange = function() {
      // console.log("readyState: " + this.readyState + ", status: " + this.status);
    if (this.readyState == 4 && this.status == 200) {
    rdyfunc(this);
    }
  };
    // set arg 3 to false for sync operation - but I can't
    // proceed until the files are complete, anyway.
  xhr.open("GET", doc, true);
  xhr.send();
}
*/
function fmtDate(dstr) {
    // expecting dstr like "2028-02-29T23:04", but anything Date 
    // will accept should do. 
    let monam = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    let d = new Date(dstr);
    let mon = monam[d.getMonth()];
    let day = d.getDate();
    let yr = d.getFullYear();
    let hr = d.getHours();
    let ampm = "AM";
    if (hr > 11) {
        ampm = "PM";
    }
    if (hr > 12) {
        hr -= 12;
    }
    let dmin = d.getMinutes();
    if (dmin < 10) {
      mins = "0" + dmin;
    } else {
      mins = "" + dmin;
    }
    // e.g., September 9, 2020 12:29PM
    let datstr = mon + " " + day + ", " + yr + " " + hr + ":" + mins + ampm;
    return(datstr);
}
</script>
</head>
<body onload="loadlib()">
<table border="1">
<tbody><tr><td colspan="3" id="tabtitl" class="tabletitle">cheat</td></tr><tr>
</tr><tr><th>Key</th><th>Song Title</th><th>Starting Words</th></tr><tr>
    <tr id="songtable"></tr>
<tr class="partsel"><td colspan="3">Show
 <input type="radio" id="seltenor" name="part" value="tenor" onclick="vsel(this)">tenor
 <input type="radio" id="sellead" name="part" value="lead" onclick="vsel(this)">lead
 <input type="radio" id="selbari" name="part" value="bari" onclick="vsel(this)">bari
 <input type="radio" id="selbass" name="part" value="bass" onclick="vsel(this)">bass
 <input type="radio" id="selmix" name="part" value="mix" selected="selected" onclick="vsel(this)">mix
 </td></tr>
</tbody></table>
</body></html>
