<!DOCTYPE html>
<!-- $Id: picksongs.tpl,v 1.4 2020/08/25 23:22:48 dfm Exp dfm $
     $Log: picksongs.tpl,v $
     Revision 1.4  2020/08/25 23:22:48  dfm
     add a bunch of css
     made code blocks to send mail or download result
     added select block for venue

     Revision 1.3  2020/07/19 19:16:20  dfm
     sytle the Done button, relabel as Send
     send the song list via email, remove the download functionality

     Revision 1.2  2020/07/13 03:48:19  dfm
     minimize the style info and include it in the template, get rid of .css file

     Revision 1.1  2020/07/10 17:07:36  dfm
     Initial revision


-->
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Pick songs</title>
<!-- select-css from https://www.filamentgroup.com/lab/select-css.html -->
<style>
.select-css {
	display: inline-block; width: auto;
    text-align: center;
	font-size: 20px;
	font-family: sans-serif;
	font-weight: 700;
	color: #444;
	line-height: 1.1;
	padding: .6em 1.4em .5em .8em;
	# width: 100%;
	# max-width: 100%;
	box-sizing: border-box;
	margin: 0;
	border: 1px solid #aaa;
	box-shadow: 0 1px 0 1px rgba(0,0,0,.04);
	border-radius: .5em;
	-moz-appearance: none;
	-webkit-appearance: none;
	appearance: none;
	background-color: #fff;
	# background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007CB2%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E'),
	  # linear-gradient(to bottom, #ffffff 0%,#e5e5e5 100%);
	background-repeat: no-repeat, repeat;
	background-position: right .7em top 50%, 0 0;
	background-size: .65em auto, 100%;
}
.select-css::-ms-expand {
	display: none;
}
.select-css:hover {
	border-color: #888;
}
.select-css:focus {
	border-color: #aaa;
	box-shadow: 0 0 1px 3px rgba(59, 153, 252, .7);
	box-shadow: 0 0 0 3px -moz-mac-focusring;
	color: #222;
	outline: none;
}
.select-css option {
	font-weight:normal;
}
table {
    font-family:Arial; font-size: 20px;
    border-width:5px; border-collapse: collapse;
    padding: 4px;
    min-width: 400px;
}
tr { page-break-inside: avoid; }
th { background-color:lightgreen; font-weight: bold; vertical-align: text-top; text-align: center; }
td { padding: 4px; text-align: center; }
.chosen { background-color: lightblue; }
.hidden { display: none; }
.donebutt { font-weight: bold; background-color: yellow; font-size: 20px; }
body{ -webkit-print-color-adjust:exact; }
</style>
<script type="text/javascript">

var songorder = 0;
var songlist = [];

function selme(el) {
    // order cell is first child of the row
    let ordel = el.childNodes[0];

    // nbsp; is char code a0 hex. cell will have
    // that value until it has been selected.
    if (ordel.textContent == "\xa0") {
        songorder += 1;
        ordel.textContent = songorder.toString();
        el.classList.add("chosen");
    } else {
        // if this song was already chosen, un-choose it and
        // blank out the order. choosing it again will put it 
        // at the current end.
        el.classList.remove("chosen");
        ordel.textContent = "\xa0";
    }
}

function togcat(el) {
    // one of the "show category" checkboxes has changed.
    // set the hidden value as appropriate for each row.
    // only set hidden if all categories for the song are un-checked.

    let songrows = document.getElementsByTagName("tr");
    let catsels = document.querySelectorAll("input[type='checkbox']");

    var showcats = [];

    for (let catel of catsels) {
        // category name follows the checkbox, and has unwanted
        // whitespace after it.
        let cat = catel.nextSibling.textContent.replace(/(\s+$)/,'');
        showcats[cat] = catel.checked;
    }

    for (let songrowel of songrows) {
        let songcats = songrowel.classList;
        if (songcats.length == 0) {
            // this row has no classes - skip it. 
            // (this will skip the header rows).
            continue;
        }

        // if any of a song's cats (except hidden) is
        // checked, show the song.
        let showit = false;
        let ishidden = false;
        for (let scat of songcats) {
            if (scat == "hidden") {
                ishidden = true;
            } else if (showcats[scat]) {
                showit = true;
            }
        }

        if (showit) {
            if (ishidden) {
                // currently hidden, but should be showed.
                songrowel.classList.remove("hidden");
            }
        } else {
            if (! ishidden) {
                // not hidden, but don't showit
                songrowel.classList.add("hidden");
            }
        }
    }
}

function alldone() {
    var songs = [];
    for (let element of document.getElementsByClassName("chosen")) {
        let ord = Number(element.childNodes[0].textContent) - 1;
        let song = element.childNodes[1].textContent;
        songs[ord] = song;
    }
    if (songs.length < 1) {
        alert("No songs selected?");
        return;
    }

    // songs array may be sparse if any song was de-selected.
    // json will put 'null' for any empty cell. this gets rid of that.
    var seq = [];
    for (let song of songs) {
        if (song) {
            seq.push(song);
        }
    }

    let venel = document.getElementById("eventvenue");
    let venue = venel.value;

    let datel = document.getElementById("eventdate");
    let evdate = datel.value;

    
    let rv = {'venue': venue, 'date':evdate, 'songs':seq};
    
    let jlist = JSON.stringify(rv);

    let mailit = false;
    if (mailit) {
        let mthref = "mailto:dmotteler@aol.com?subject=songlist&body=" + jlist;
        let mtel = document.getElementById("mtcell");
        mtel.href = mthref;
        mtel.click();
    } else {
        let pom = document.createElement('a');
        pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(jlist));
        pom.setAttribute('download', "songlist.json");
        pom.style.display = 'none';
        document.body.appendChild(pom);
        pom.click();
        document.body.removeChild(pom);
    }
    console.log(jlist);
}

function init() {
    // init date picker to next Tuesday (today if it's Tuesday)
    let d = new Date();
    d.setDate(d.getDate() + (7 - d.getDay() + 2) % 7);
    let datel = document.getElementById("eventdate");

    let day = d.getDate();
    let dstr = "" + day;
    if (day < 10) {
        dstr = "0" + day;
    }

    let mo = d.getMonth() + 1;
    let mstr = "" + mo;
    if (mo < 10) {
        mstr = "0" + mo;
    }

    datel.value = d.getFullYear() + "-" + mstr + "-" + dstr + "T19:00";
}
</script>
</head>
<body onLoad="init()">
<table border="1">
<tr><th colspan='2'>Songs for 
<input type="text" list="venues" id="eventvenue" class="select-css" />
<datalist id="venues">
<option>Rehearsal</option>
<option>Chehalis West</option>
<option>Colonial</option>
<option>Prestige Care</option>
<option>Sharon Care</option>
<option>Vintage</option>
<option>Woodland Village</option>
<option>Zoom</option>
</datalist>
<!-- <select class="select-css" id="eventvenue">
</select>
-->
&nbsp;on&nbsp;<input type="datetime-local" class="select-css" value="" id="eventdate" step="900">
</th></tr>
<tr>
<th><input type="button" class="donebutt" value="Send" onclick="alldone()"/></th>
<th>Song Title</th>
</tr>
 <tr class="Current PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>After You've Gone</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Bad, Bad Leroy Brown</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Breaking Up Is Hard To Do</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Bright Was The Night</td></tr>
 <tr class="ComingSoon" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Bye Bye, Love</td></tr>
 <tr class="ComingSoon" onclick="selme(this)"><td class="ord">&nbsp;</td><td>California Dreamin'</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Caroline</td></tr>
 <tr class="Current PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Coney Island Baby</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Consider Yourself</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Darkness On The Delta</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Daydream</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Dona Nobis Pacem</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Down By The Old Mill Stream</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Down Our Way</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Drivin' Me Crazy</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Edelweiss</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>From The First Hello To The Last Goodbye</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>God Bless America</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Happy Together</td></tr>
 <tr class="Current PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Hello Mary Lou</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Honey/Little 'Lize - Medley</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Hooked On a Feeling</td></tr>
 <tr class="Current PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>I Don't Know Why</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>I've Been Working On The Railroad</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>In My Room</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Irish Blessing</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Keep The Whole World Singing</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Let Me Call You Sweetheart</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Let's Get Together Again</td></tr>
 <tr class="PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Lida Rose/Will I Ever Tell You</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Longest Time, The</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Muskrat Ramble</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>My Girl</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>My Wild Irish Rose</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>O Danny Boy</td></tr>
 <tr class="ComingSoon" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Old Devil Moon</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Old Songs, The</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>On The Sunny Side of the Street</td></tr>
 <tr class="Current PoleCatII" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Over The Rainbow</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Riders In The Sky</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Sentimental Journey</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Seven Bridges Road</td></tr>
 <tr class="ComingSoon" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Seventy-Six Trombones</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Shine On Me</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Shut De Do</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Sixteen Tons</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Stand By Me</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Star-Spangled Banner, The</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Story Of The Rose</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Sweet And Lovely</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Sweet, Sweet Roses of Morn</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Turn Your Radio On!</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Under The Boardwalk</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Wait Till The Sun Shines, Nellie</td></tr>
 <tr class="Show" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Who Put the Bomp</td></tr>
 <tr class="Current" onclick="selme(this)"><td class="ord">&nbsp;</td><td>Yesterday</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>You Tell Me Your Dream</td></tr>
 <tr class="PoleCat" onclick="selme(this)"><td class="ord">&nbsp;</td><td>You're The Flower Of My Heart, Sweet Adeline</td></tr>
<tr><td colspan='2'>
 <input type='checkbox' name='cats' checked="1" onchange="togcat(this)">ComingSoon</input>
 <input type='checkbox' name='cats' checked="1" onchange="togcat(this)">Current</input>
 <input type='checkbox' name='cats' checked="1" onchange="togcat(this)">PoleCat</input>
 <input type='checkbox' name='cats' checked="1" onchange="togcat(this)">PoleCatII</input>
 <input type='checkbox' name='cats' checked="1" onchange="togcat(this)">Show</input>
</td></tr>
</table>
<a class="hidden" id="mtcell" href=""</a>
</body>
</html>
